<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>   
     <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Datastory.ch</title>
</head>
<style>
 
body {
	/*font: 10px 'Gentium Book Basic', sans-serif;*/
	font: 16pt Helvetica, sans-serif;
	background-color: #000;
	padding:0;
}
 
svg {
	border: 1px solid white;
}
 
/*
svg * {
	fill: #be64ac;
}
*/

.color1 {
	fill: #be64ac;
}

.color2 {
	fill: #5ac8c8;
}

button {
	color: black;
	border: 1px solid cyan;
	background-color: black;
	outline: none;
}

path {
	//stroke: #be64ac;
	//stroke-width: 1em;
}

</style>
<body>
<!-- CASTLE -->
<!--
<svg width=400 height=400>
<g transform="scale 0.5">
<path d="m 319,55 -40,0 0,35 -25,0 0,-35 -40,0 0,35 -25,0 0,-35 -40,0 0,35 -25,0 0,-35 -39.998104,0.0036 0,59.99447 29.994194,30.00971 L 114,307 l -15,18 0,25 205,0 0.0223,-24.95536 L 289,306.99875 289,145 l 30,-30 0,-60 z" />
</g>
</svg>
-->
<script src="./d3.v3.min.js"></script>
<script>

/*
//optimisation: d3 over webgl ? perte souplesse xml ?
*/

castle_shape = "m 319,55 -40,0 0,35 -25,0 0,-35 -40,0 0,35 -25,0 0,-35 -40,0 0,35 -25,0 0,-35 -39.998104,0.0036 0,59.99447 29.994194,30.00971 L 114,307 l -15,18 0,25 205,0 0.0223,-24.95536 L 289,306.99875 289,145 l 30,-30 0,-60 z";
rectangle_shape = "M0,0 200,0 200,254 0,254"


list = [
	"Truc",
	"Machin",
	"Bidule"
]

w = 1200;
h = 400;

svg = d3.select("body").append("svg")
	.attr("width",w)
	.attr("height",h);	

/** Animate objects from to */
function go(truc,from,to,classe) {
	//default parameters
	(typeof classe === "undefined") ? "color1" : classe;
	var g = svg.append("g")
		.attr("transform","translate("+from.x+","+from.y+")")
		.attr("class",classe);
	create(g,truc);
	var	scale = 0.1;
	g.transition()
			.duration(8000)
			/*.attr("transform","translate("+(-from.x)+","+(-from.y)+") "
				//+ "scale("+scale+") " //FIXME: scaling is too complex...
				+ "translate("+(to.x)+","+(to.y)+") " ) //FIXME with matrix transform http://stackoverflow.com/questions/6711610/how-to-set-transform-origin-in-svg
			*/
			.attr("transform","scale ("+scale+") translate("+to.x/scale+","+to.y/scale+")") 
			//.attr("transform","translate("+to.x/scale+","+to.y/scale+")") // use this if no scaling
			.style("opacity","0");
			//.remove() //TODO if needed with optimization
}

function create(element,text) {
	var g = element.append("g")
		//.remove()   //remove from the dom immediately after having added it //FIXME
		.append("text")
		.attr("x",0)
		.attr("y",0)
		.style("text-anchor","middle")
		.attr("transform","translate(0,50)")
		.html(text);
	var shape_g = element.append("g")
			.attr("transform","scale(0)");
	shape_g.append("path")
		.attr("d",Math.random()>0.5 ? castle_shape : rectangle_shape);
	shape_g.transition()
		.duration(1000)
		.attr("transform","scale(0.5)")
	//FIXME -> takes only the text...
	g.style("opacity","0")
		.transition()
		.duration(1000)
			.style("opacity","1");
	return g;
}

// jitter along one dimension in the given span
function jitter(coord,span) {
	return coord + (Math.random()>0.5 ? -1 : 1) * Math.random()*span/2;
}

who = 0;
function display(truc) {
	go(truc,
			{x:(++who % 2 == 0) ? jitter(100,50) : jitter(w-200,50),
				y:jitter(h-300,100)},
			{x:w/2,y:0},
			(who % 2 == 0) ? "color1" : "color2"
		);
}

counter = 0;
d3.select("body").append("button")
	.on("click", function() {
		display(list[counter++ % list.length]);
	})
	.text("NEXT");

</script>
</body>